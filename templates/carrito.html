{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% load math_filters %}

{% block content %}
<div class="row mb-4">
    <div class="col-12 d-flex align-items-center">
      <div class="flex-grow-1 border-top border-primary me-3"></div>
      <h2 class="text-primary me-3 mb-0">Carrito</h2>
      <div class="flex-grow-1 border-top border-primary ms-3"></div>
    </div>
</div>

{% if carrito %}
  <table class="table align-middle">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Precio</th>
        <th>Cantidad</th>
        <th>Subtotal</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for id, item in carrito.items %}
        <tr>
          <td>
            {{ item.nombre }}
          </td>
          <td>${{ item.precio|floatformat:0|intcomma }}</td>
          <td>
            <div class="d-flex align-items-center gap-2">
              <a href="{% url 'disminuir_cantidad' id %}" class="btn btn-outline-secondary btn-sm">-</a>
              <span>{{ item.cantidad }}</span>
              <a href="{% url 'incrementar_cantidad' id %}" class="btn btn-outline-secondary btn-sm">+</a>
            </div>
          </td>
          <td>
            ${{ item.precio|mul:item.cantidad|floatformat:0|intcomma }}
          </td>
          <td>
            <a href="{% url 'eliminar_del_carrito' id %}" class="btn btn-danger btn-sm">Eliminar</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <h4>Total: ${{ total|floatformat:0|intcomma }}</h4>

  <!-- Botón de pagar condicionado al login -->
  <div class="mt-3 text-center">
    {% if user.is_authenticated %}
      <a href="{% url 'checkout' %}" class="btn btn-success btn-lg">Pagar</a>
    {% else %}
      <div class="alert alert-info mt-3">
        Para confirmar tu compra necesitás iniciar sesión.
      </div>
      <a href="{% url 'account_login' %}" class="btn btn-warning btn-lg">Inicia sesión para comprar</a>
    {% endif %}
  </div>

{% else %}
  <p>Tu carrito está vacío.</p>
{% endif %}
{% endblock %}
