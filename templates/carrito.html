{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% load math_filters %}

{% block content %}
<div class="row mb-4">
    <div class="col-12 d-flex align-items-center">
      <div class="flex-grow-1 border-top border-primary me-3"></div>
      <h2 class="text-primary me-3 mb-0">Carrito</h2>
      <div class="flex-grow-1 border-top border-primary ms-3"></div>
    </div>
</div>

{% if carrito %}
  <table class="table align-middle">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Precio</th>
        <th>Cantidad</th>
        <th>Subtotal</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for id, item in carrito.items %}
        <tr>
          <td>
            {{ item.nombre }}
            {% if item.stock and item.stock > 0 %}
              <span class="badge bg-success ms-2">Disponible</span>
            {% else %}
              <span class="badge bg-danger ms-2">Sin stock</span>
            {% endif %}
          </td>
          <td>${{ item.precio|floatformat:0|intcomma }}</td>
          <td>
            {% if item.stock and item.stock > 0 %}
              <div class="d-flex align-items-center gap-2">
                <a href="{% url 'disminuir_cantidad' id %}" class="btn btn-outline-secondary btn-sm">-</a>
                <span>{{ item.cantidad }}</span>
                <a href="{% url 'incrementar_cantidad' id %}" class="btn btn-outline-secondary btn-sm">+</a>
              </div>
            {% else %}
              <span class="text-muted">No disponible</span>
            {% endif %}
          </td>
          <td>
            ${{ item.precio|mul:item.cantidad|floatformat:0|intcomma }}
          </td>
          <td>
            <a href="{% url 'eliminar_del_carrito' id %}" class="btn btn-danger btn-sm">Eliminar</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <h4>Total: ${{ total|floatformat:0|intcomma }}</h4>

  <!-- Botón de pagar -->
  <div class="mt-3">
    <a href="{% url 'checkout' %}" class="btn btn-success btn-lg">Pagar</a>
  </div>

{% else %}
  <p>Tu carrito está vacío.</p>
{% endif %}
{% endblock %}
